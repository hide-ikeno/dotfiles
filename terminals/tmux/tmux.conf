##
## ~/.tmux.conf
##
## The configuration file for Terminal MUltipleXer (tmux)
##

#
# NOTE:
#
#   | command           | alias  |
#   |-------------------+--------|
#   | set-option        | set    |
#   | set-window-option | setw   |
#   | bind-key          | bind   |
#   | unbind-key        | unbind |
#

#=============================
# General settings
#=============================

# Prefix key --- <C-Space> [default: <C-b>]
set-option -g  prefix C-Space
unbind-key C-b
# map prefix + prefix to send prefix key to terminal
bind-key   C-Space send-prefix

# Default termtype. If $TERM is set, the value is overwritten.
set-option -g  default-terminal "screen-256color"
# True Color
set-option -ga terminal-overrides ",xterm-256color:Tc"
# set-option the number of paste buffer (default: 20)
set-option -g  buffer-limit 50
# Maximum number of lines held in window history (default: 2000)
set-option -g  history-limit 10000

# Escape time in milliseconds (default: 500)
set-option -sg escape-time 0
# Update 'status-left' and 'status-right' every 5 second [default: 15]
set-option -g status-interval 5
# Display time in milliseconds (default: 750)
set-option -g  display-time 5000
# Display time for the indicator in milliseconds (default: 1000)
set-option -g  display-panes-time 5000

# Enable mouse support
set-option -g  mouse on

# Start index of window/pane with 1 (default: 0)
set-option        -g base-index 1
set-window-option -g pane-base-index 1
# Reset window number when a window is closed.
set-option        -g renumber-windows on
# Disable automatic window renaming
set-window-option -g allow-rename off
# Aggressive window resize
set-window-option -g aggressive-resize on

# # support logging out and back in
# set -g update-environment "SSH_ASKPASS SSH_AUTH_SOCK SSH_AGENT_PID_SSH_CONNECTION"

#=============================
# Keybindings
#=============================

# Use vi-like keybindings in copy mode
set-window-option -g mode-keys vi

# Use emacs-like keybindings in tmux command prompt (prefix + :)
set-option -g status-keys emacs

# Unbind default keybinds, which are goint to be overritten.
unbind-key %    # split-window -h
unbind-key '"'  # split-window
unbind-key [    # copy-mode
unbind-key ]    # paste-buffer
unbind-key "'"  # select-window
unbind-key n    # next-window
unbind-key p    # previous-window

# Reload the tmux configuration file
bind-key C-r source-file ~/.config/tmux/tmux.conf \; display "[tmux] tmux.conf reloaded!"

# Split panes
bind-key | split-window -h -c "#{pane_current_path}" # horizontal
bind-key - split-window -v -c "#{pane_current_path}" # vertical

# Select windows (prev: 'M-S-[', next: 'M-S-]')
bind-key -n M-{ previous-window
bind-key -n M-} next-window

# Select panse (prev: 'M-[', next: 'M-]')
bind-key -n M-[ select-pane -t :.-
bind-key -n M-] select-pane -t :.+

# Move panes
bind-key -n M-h select-pane -L
bind-key -n M-j select-pane -D
bind-key -n M-k select-pane -U
bind-key -n M-l select-pane -R

# Resize pane
bind-key -n M-H resize-pane -L 2
bind-key -n M-J resize-pane -D 2
bind-key -n M-K resize-pane -U 2
bind-key -n M-L resize-pane -R 2

# for Mac OSX (make pbcopy/pbpaste and Vim's * register work.)
if-shell 'test "$(uname)" = "Darwin"' '\
  set-option -g default-command "reattach-to-user-namespace -l $SHELL"; \
'

# --- Keybindings in copy-mode-vi
# unbind default bindings
unbind-key -T copy-mode-vi Enter  # send-keys -X copy-selection-and-cancel
# C-Space Space to begin selection
bind-key -T copy-mode-vi Space send-keys -X begin-selection
# prefix + v to begin selection
bind-key -T copy-mode-vi v send-keys -X begin-selection
# When scrolling with mouse wheel, reduce number of scrolled rows per tick to
# "2" [default: 5 rows per tick].
bind-key -T copy-mode-vi WheelUpPane   select-pane \; send-keys -X -N 2 scroll-up
bind-key -T copy-mode-vi WheelDownPane select-pane \; send-keys -X -N 2 scroll-down

# prefix + p to paste selection
bind-key p  paste-buffer

# TODO: yank keybindings

#=============================
# Colorscheme
#=============================
onedark_black="#282c34"
onedark_maroon="#e06c75"
onedark_green="#98c379"
onedark_olive="#d19a66"
onedark_navy="#61afef"
onedark_purple="#c678dd"
onedark_teal="#56b6c2"
onedark_silver="#abb2bf"
onedark_grey="#5c6370"
onedark_red="#e06c75"
onedark_lime="#98c379"
onedark_yellow="#d19a66"
onedark_blue="#61afef"
onedark_magenta="#c678dd"
onedark_cyan="#56b6c2"
onedark_white="#ffffff"

# icons
divider_left=""
subdivider_left=""
divider_right=""
subdivider_right=""

#=============================
# Appearance
#=============================
# --- Window mode
set-option -g mode-style "fg=default,bg=$onedark_yellow"

# --- Command line (message)
set-option -g message-style "fg=$onedark_black,bg=$onedark_yellow"

# --- Window status
set-window-option -g window-status-separator ""
set-window-option -g window-status-format " #I:#W "
set-window-option -g window-status-current-style  "fg=$onedark_grey,bold,bg=$onedark_black"

set-window-option -g window-status-format \
  "#[fg=$onedark_black,bg=$onedark_black,nobold,nounderscore,noitalics]$divider_left#[fg=$onedark_grey,bg=$onedark_black] #I $subdivider_left #W #[fg=$onedark_black,bg=$onedark_black,nobold,nounderscore,noitalics]$divider_left"
set-window-option -g window-status-current-format \
  "#[fg=$onedark_black,bg=$onedark_grey,nobold,nounderscore,noitalics]$divider_left#[fg=$onedark_silver,bg=$onedark_grey,nobold] #I $subdivider_left #W #[fg=$onedark_grey,bg=$onedark_black,nobold,nounderscore,noitalics]$divider_left"

# style for windows with activity alert
set-window-option -g window-status-activity-style "fg=$onedark_yellow"

# --- Pane border
set-window-option -g pane-border-style        "fg=$onedark_silver"
set-window-option -g pane-active-border-style "fg=$onedark_silver"

set-option -g display-panes-colour        "$onedark_blue"
set-option -g display-panes-active-colour "$onedark_yellow"

# --- Status line
set-option -g status on
set-option -g status-position top
set-option -g status-justify  left
set-option -g status-left-length  100
set-option -g status-right-length 100

set-option -g status-style "fg=$onedark_grey,bg=$onedark_black"

time_format=" %Y-%m-%d %H:%M"
status_widgets="#(tmux-mem-cpu-load --powerline-right --interval 2 --cpu-mode 0 --mem-mode 2 --graph-lines 0)"
set-option -g status-left \
  "#[fg=$onedark_grey,bg=$onedark_lime,bold] #S #{prefix_highlight}#[fg=$onedark_lime,bg=$onedark_black,nobold,nounderscore,noitalics]$divider_left"
set-option -g status-right \
  "${status_widgets} #[fg=$onedark_grey,bg=$onedark_black]$divider_right#[fg=$onedark_grey,bg=$onedark_grey]$divider_right#[fg=$onedark_silver, bg=$onedark_grey]${time_format} #[fg=$onedark_lime,bg=$onedark_grey,nobold,nounderscore,noitalics]$divider_right#[fg=$onedark_black,bg=$onedark_lime,bold] #h #[fg=$onedark_yellow,bg=$onedark_lime]$divider_right#[fg=$onedark_red,bg=$onedark_yellow]$divider_right"


# ============================
# ===       Plugins        ===
# ============================
# plugin manager
set-option -g @plugin 'tmux-plugins/tpm'
# battery status
set-option -g @plugin 'tmux-plugins/tmux-battery'
# open highlighted section directly from copy-mode
set-option -g @plugin 'tmux-plugins/tmux-open'
# hightlight when prefix key is on
set-option -g @plugin 'tmux-plugins/tmux-prefix-highlight'
# copy to clipboard
set-option -g @plugin 'tmux-plugins/tmux-yank'
# cpu, memory, load avarage
set-option -g @plugin 'samoshkin/tmux-plugin-sysstat'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
